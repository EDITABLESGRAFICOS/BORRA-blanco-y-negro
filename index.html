<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Editor Profesional - Limpiar Negro y Blanco</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #f0f0f0;
    margin: 0;
    padding: 0;
    display: flex;
    height: 100vh;
  }
  .sidebar {
    width: 300px;
    background: #fff;
    padding: 20px;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .main {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #e9e9e9;
    overflow: hidden;
  }
  h2 {
    color: #333;
    font-size: 18px;
    margin-bottom: 10px;
  }
  .controls {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  input[type="file"] {
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #aaa;
  }
  button {
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover {
    background: #45a049;
  }
  .slider-container {
    display: flex;
    flex-direction: column;
  }
  input[type="range"] {
    width: 100%;
  }
  label span {
    font-weight: bold;
  }
  .canvas-wrapper {
    width: 90%;
    height: 90%;
    overflow: auto;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #fff;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  canvas {
    max-width: none;
    max-height: none;
    border-radius: 8px;
  }
  .zoom-slider {
    display: none;
    flex-direction: column;
  }
</style>
</head>
<body>
  <div class="sidebar">
    <h2>Editor Profesional</h2>

    <input type="file" id="upload" accept="image/*">

    <div class="controls">
      <div class="slider-container">
        <label>Umbral Negro: <span id="blackValue">0</span></label>
        <input type="range" id="blackThreshold" min="0" max="255" value="0">
      </div>
      <div class="slider-container">
        <label>Umbral Blanco: <span id="whiteValue">255</span></label>
        <input type="range" id="whiteThreshold" min="0" max="255" value="255">
      </div>
    </div>

    <button id="zoomToggle">üîç Lupa</button>
    <div class="zoom-slider" id="zoomControls">
      <label>Zoom: <span id="zoomValue">1</span>x</label>
      <input type="range" id="zoomRange" min="1" max="5" value="1" step="0.1">
    </div>

    <button id="export">Exportar PNG 300dpi</button>
  </div>

  <div class="main">
    <div class="canvas-wrapper">
      <canvas id="canvas"></canvas>
    </div>
  </div>

<script>
const upload = document.getElementById('upload');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const blackSlider = document.getElementById('blackThreshold');
const whiteSlider = document.getElementById('whiteThreshold');
const blackValue = document.getElementById('blackValue');
const whiteValue = document.getElementById('whiteValue');
const zoomToggle = document.getElementById('zoomToggle');
const zoomControls = document.getElementById('zoomControls');
const zoomRange = document.getElementById('zoomRange');
const zoomValue = document.getElementById('zoomValue');

let img = new Image();
let imgDataOriginal = null;
let zoomFactor = 1;

// Subir imagen
upload.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(event) {
    img.src = event.target.result;
  }
  reader.readAsDataURL(file);
});

// Mostrar imagen y guardar datos originales
img.onload = () => {
  canvas.width = img.width;
  canvas.height = img.height;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(img, 0, 0);
  imgDataOriginal = ctx.getImageData(0, 0, canvas.width, canvas.height);
  updatePreview();
};

// Actualizar preview seg√∫n umbrales
function updatePreview() {
  if (!imgDataOriginal) return;
  const imageData = ctx.createImageData(imgDataOriginal);
  const dataOriginal = imgDataOriginal.data;
  const data = imageData.data;
  const blackThreshold = parseInt(blackSlider.value);
  const whiteThreshold = parseInt(whiteSlider.value);

  for (let i = 0; i < data.length; i += 4) {
    const r = dataOriginal[i];
    const g = dataOriginal[i+1];
    const b = dataOriginal[i+2];

    if(r < blackThreshold && g < blackThreshold && b < blackThreshold){
      data[i+3] = 0;
    }
    else if(r > whiteThreshold && g > whiteThreshold && b > whiteThreshold){
      data[i+3] = 0;
    }
    else{
      data[i] = r;
      data[i+1] = g;
      data[i+2] = b;
      data[i+3] = 255;
    }
  }
  ctx.putImageData(imageData, 0, 0);
}

// Escucha cambios en sliders
blackSlider.addEventListener('input', () => {
  blackValue.textContent = blackSlider.value;
  updatePreview();
});

whiteSlider.addEventListener('input', () => {
  whiteValue.textContent = whiteSlider.value;
  updatePreview();
});

// Toggle zoom controls
zoomToggle.addEventListener('click', () => {
  zoomControls.style.display = zoomControls.style.display === 'flex' ? 'none' : 'flex';
});

// Controlar zoom con slider
zoomRange.addEventListener('input', () => {
  zoomFactor = parseFloat(zoomRange.value);
  zoomValue.textContent = zoomFactor.toFixed(1);
  canvas.style.transform = `scale(${zoomFactor})`;
  canvas.style.transformOrigin = 'top left';
});

// Exportar PNG
const exportBtn = document.getElementById('export');
exportBtn.addEventListener('click', () => {
  updatePreview();
  const scale = 2;
  const exportCanvas = document.createElement('canvas');
  exportCanvas.width = canvas.width * scale;
  exportCanvas.height = canvas.height * scale;
  const exportCtx = exportCanvas.getContext('2d');
  exportCtx.imageSmoothingEnabled = false;
  exportCtx.drawImage(canvas, 0, 0, canvas.width, canvas.height,
                               0, 0, exportCanvas.width, exportCanvas.height);

  const link = document.createElement('a');
  link.download = `imagen_procesada_${Date.now()}.png`;
  link.href = exportCanvas.toDataURL('image/png');
  link.click();
});
</script>
</body>
</html>
